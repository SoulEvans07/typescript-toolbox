<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <title>The Escape</title>
  </head>
  <body>
    <div class="container">
      <div class="controls">
        <div class="min-max">
          <input id="min" type="number" value="4" />
          <input id="max" type="number" value="8" />
        </div>
        <input id="seed" type="number" value="1111" />
        <button id="randomize">randomize</button>
        <button id="generate">generate</button>
        <button id="solve">solve</button>
        <button id="randGen">all</button>
      </div>
      <div id="maze_container"><!-- --></div>
      <button id="from-text">from text</button>
      <textarea id="maze-json"></textarea>
      <textarea id="maze-json-string"></textarea>
      <textarea id="solution-json"></textarea>
    </div>
    <!-- <script src="/maze-builder.js"></script> -->
    <!-- <script src="/mazeBuilder.js"></script> -->
    <!-- <script src="/build/utils/random.js" type="module"></script>
    <script src="/build/the-escape/mazeBuilder.js" type="module"></script> -->
    <script type="module">
      import { Random } from "/build/utils/random.js";
      import { MazeBuilder } from "/build/the-escape/mazeBuilder.js";
      import { MazeDrawer } from "/build/the-escape/mazeDrawer.js";
      import { MazeSolver } from "/build/the-escape/mazeSolver.js";

      document.solver = MazeSolver.solve;

      let maze;

      function generate() {
        const seedInput = document.getElementById("seed");
        const seed = Number(seedInput.value);

        const minInput = document.getElementById("min");
        const min = Number(minInput.value);

        const maxInput = document.getElementById("max");
        const max = Number(maxInput.value);

        const builder = new MazeBuilder(seed, min, max);
        builder.placeKey();
        maze = builder.getMaze();
        drawMaze();

        const json = document.getElementById("maze-json");
        json.value = JSON.stringify(maze);

        const string = document.getElementById("maze-json-string");
        string.value = '"' + JSON.stringify(maze).replace(/"/g, '\\"') + '"';
      }

      function drawMaze() {
        MazeDrawer.drawMaze(maze, "maze_container");
      }

      function solve() {
        const path1 = MazeSolver.solve(maze, "S", "K");
        MazeDrawer.drawPath(path1, "path-key-1");

        const [, ...path2] = MazeSolver.solve(maze, "K", "E");
        MazeDrawer.drawPath(path2, "path-key-2");

        const solution = [...path1, ...path2];
        const text = document.getElementById("solution-json");
        text.value = JSON.stringify(solution);
      }

      function randomize() {
        const seedInput = document.getElementById("seed");
        seedInput.value = Random.randomSeed();
      }

      randomize();
      generate();
      solve();

      const rand = document.getElementById("randomize");
      rand.onclick = () => randomize();

      const gen = document.getElementById("generate");
      gen.onclick = () => generate();

      const sol = document.getElementById("solve");
      sol.onclick = () => solve();

      const rng = document.getElementById("randGen");
      rng.onclick = () => {
        randomize();
        generate();
        solve();
      };

      const fromText = document.getElementById("from-text");
      fromText.onclick = () => {
        const text = document.getElementById("maze-json");
        const json = '"' + text.value.replace(/'/g, '\\"').replace(/\s/g, "") + '"';
        
        console.log(json);
        maze = JSON.parse(JSON.parse(json));
        
        drawMaze();

        const string = document.getElementById("maze-json-string");
        string.value = '"' + JSON.stringify(maze).replace(/"/g, '\\"') + '"';
      };
    </script>
  </body>
</html>
